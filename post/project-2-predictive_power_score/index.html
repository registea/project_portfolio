<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Feature Importance: Predictive Power Score | Anthony Registe</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.71.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="https://registea.github.io/project_portfolio/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Feature Importance: Predictive Power Score" />
<meta property="og:description" content="Exploring the filter method" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://registea.github.io/project_portfolio/post/project-2-predictive_power_score/" />
<meta property="article:published_time" content="2020-07-13T12:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-13T12:00:00+00:00" />
<meta itemprop="name" content="Feature Importance: Predictive Power Score">
<meta itemprop="description" content="Exploring the filter method">
<meta itemprop="datePublished" content="2020-07-13T12:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-07-13T12:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1629">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Feature Importance: Predictive Power Score"/>
<meta name="twitter:description" content="Exploring the filter method"/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://registea.github.io/project_portfolio/images/project2/header-image.png');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://registea.github.io/project_portfolio/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Anthony Registe
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://registea.github.io/project_portfolio/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://registea.github.io/project_portfolio/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://registea.github.io/project_portfolio/post/" title="Projects page">
              Projects
            </a>
          </li>
          
        </ul>
      
      







<a href="https://www.linkedin.com/in/anthony-registe/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/registea/" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>








    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Feature Importance: Predictive Power Score</h1>
          
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              Exploring the filter method
            </h2>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        PROJECTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://registea.github.io/project_portfolio/post/project-2-predictive_power_score/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://registea.github.io/project_portfolio/post/project-2-predictive_power_score/&amp;text=Feature%20Importance:%20Predictive%20Power%20Score" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://registea.github.io/project_portfolio/post/project-2-predictive_power_score/&amp;title=Feature%20Importance:%20Predictive%20Power%20Score" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Feature Importance: Predictive Power Score</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2020-07-13T12:00:00Z">July 13, 2020</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><figure>
    <img src="https://registea.github.io/project_portfolio/images/project2/header-image.png"/> 
</figure>

<!-- raw HTML omitted -->
<h1 id="introduction">Introduction</h1>
<p>This notebook explores the Predictive Power Score (PPS) filter method
created by Florian Wetschoreck and posted on
<a href="https://towardsdatascience.com/rip-correlation-introducing-the-predictive-power-score-3d90808b9598">Medium</a>.
The article describes the PPS as a data type agnostic normalised score
of predictive power. The example in the article provided was written in
python, this notebook implements the PPS in R, via a custom function.</p>
<p>To explore the PPS, the house price prediction
<a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques">dataset</a>
from kaggle is used. This dataset is relatively large from a dimensional
perspective but relatively small with regards to observations.</p>
<p>This notebook will not focus on the exploratory analysis or feature
engineering steps in the model building process, but jump directly to
evaluating variable importance using this metric. If you are interested
in a full analysis of this dataset, then please follow this link to my
kaggle
<a href="https://www.kaggle.com/ar89dsl/house-price-eda-predictive-power-score">kernal</a>.</p>
<h1 id="exploring-the-target-variable-saleprice">Exploring the target Variable ‘saleprice’</h1>
<p>The histogram shows the distribution of the ‘saleprice’ variable across
all house sales. We can see that the majority of houses are around 150k
in price, this is confirmed by calculating the median which sits at
163k. The data has a long tail to the right, indicating that there are a
small number of high priced houses. The skewness of house prices is
1.88, as this is above 1 it indicates that the data is highly positively
skewed.</p>
<figure>
    <img src="https://registea.github.io/project_portfolio/images/project2/target_var_plot1-1.png"/> 
</figure>

<p>Applying a log transformation to the ‘saleprice’ variable makes the
data more symmetrical and reduces the skew to 0.12. A skewness value
between 0 and 0.5 indicates it is now minimally skewed. This can be
visualised below in the histogram, in which the distribution appears to
be a closer representation of a normal distribution. The log
transformation has been explored here but will be applied in a later
section.</p>
<figure>
    <img src="https://registea.github.io/project_portfolio/images/project2/target_var_plot2-1.png"/> 
</figure>

<h1 id="feature-selection-via-feature-importance">Feature Selection via Feature Importance</h1>
<p>A high dimensional dataset can be very useful for prediction, the
numerous combinations of predictors can be utilised by a model to
accurately predict a target of interest. There are also drawbacks of
having a large feature set, these primarily are on computation time and
resources. It some cases multiple predictors contain similar features or
have no meaningful relationship with the target variable. In these cases,
the additional features can have adverse effects on model performance.
There are a few different approaches to selecting features, one of the
simplest is using a filter approach. This approach, measures the
relationship between an individual predictor and the target variable. It
is simple, because it is evaluated without reference to other
predictors, which it may have a meaningful relationship with.</p>
<h2 id="introducing-predictive-power-score-pps">Introducing Predictive Power Score (PPS)</h2>
<p>A comprehensive breakdown of the PPS can be found
<a href="https://towardsdatascience.com/rip-correlation-introducing-the-predictive-power-score-3d90808b9598">here</a>
where Florian Wetschoreck introduces the approach. It is delicately
summarised as <em>“an asymmetric, data-type-agnostic score for predictive
relationships between two columns that ranges from 0 to 1”</em>. A score of
0 indicates the independent variable has no relationship with the target
and a score of 1 indicates a perfect relationship of predictive power.
The approach uses a naive model and a evaluation metric (RMSE in this
case), the naive model sits as the upper bound (worst case possible) and
the individual predictor is evaluated with reference to how well it
predicts in relation to the naive model.</p>
<p>The function ‘f_PPS’ built below, is the implementation of the PPS
score and is summarised in the following way:</p>
<ul>
<li>Creates a two variable dataframe containing a single predictor and
target variable</li>
<li>Pre-process numerical data with normalisation or creating dummy
variables for nominal data</li>
<li>Builds a Cross Validated (CV) hyperparameter tuned decision tree and
predicts on validation data</li>
<li>Creates a naive model to be stored as the upper bound, in this case
using the just the median ‘saleprice’</li>
<li>Compare decision tree evaluation metric with naive model in a
normalisation function (.pred - UB) / (LB - UB) to restrict the
score between 0 and 1</li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Predictive Power Score Function</span>
f_PPS <span style="color:#f92672">&lt;-</span>
  <span style="color:#a6e22e">function</span>(predictor, target, model_mode,
           evaluation_metric, LB,
           grid_size, folds,
           seedval <span style="color:#f92672">=</span> <span style="color:#ae81ff">1989</span>)
  {

    <span style="color:#75715e"># Combine predictor and target variable from inputs</span>
    df <span style="color:#f92672">&lt;-</span>
      <span style="color:#a6e22e">data.frame</span>(predictor <span style="color:#f92672">=</span> predictor,
                 target <span style="color:#f92672">=</span> target
                 )

    <span style="color:#75715e"># Add pre-processing steps</span>
    recipe <span style="color:#f92672">&lt;-</span>
      df <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">recipe</span>(target <span style="color:#f92672">~</span> .) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">step_dummy</span>(<span style="color:#a6e22e">all_nominal</span>(), <span style="color:#f92672">-</span><span style="color:#a6e22e">all_outcomes</span>()) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">prep</span>()

    <span style="color:#75715e"># Apply transformation</span>
    df <span style="color:#f92672">&lt;-</span> recipe <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">bake</span>(df)

    <span style="color:#75715e"># Cross validation</span>
    <span style="color:#a6e22e">set.seed</span>(seedval) <span style="color:#75715e"># set the seed</span>
    l_cv <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vfold_cv</span>(df, v <span style="color:#f92672">=</span> folds, strata <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;target&#34;</span>) <span style="color:#75715e"># Cross validation</span>

    <span style="color:#75715e"># Set the model engine</span>
    mod <span style="color:#f92672">&lt;-</span>
      <span style="color:#a6e22e">decision_tree</span>(mode <span style="color:#f92672">=</span> model_mode,
                    cost_complexity <span style="color:#f92672">=</span> <span style="color:#a6e22e">tune</span>(),
                    tree_depth <span style="color:#f92672">=</span> <span style="color:#a6e22e">tune</span>(),
                    min_n <span style="color:#f92672">=</span> <span style="color:#a6e22e">tune</span>()
                    ) <span style="color:#f92672">%&gt;%</span>
      <span style="color:#a6e22e">set_engine</span>(<span style="color:#e6db74">&#34;rpart&#34;</span>)

    <span style="color:#75715e"># Evaluation metric</span>
    <span style="color:#a6e22e">if</span>(evaluation_metric <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;rmse&#34;</span>) {
      metric_eval <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;rmse&#34;</span>
      metric_focus <span style="color:#f92672">&lt;-</span> yardstick<span style="color:#f92672">::</span><span style="color:#a6e22e">metric_set</span>(rmse)
    } else <span style="color:#a6e22e">if </span>(evaluation_metric <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mae&#34;</span>) {
      metric_eval <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;mae&#34;</span>
      metric_focus <span style="color:#f92672">&lt;-</span> yardstick<span style="color:#f92672">::</span><span style="color:#a6e22e">metric_set</span>(mae)
    } else <span style="color:#a6e22e">if </span>(evaluation_metric <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mape&#34;</span>) {
      metric_eval <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;mape&#34;</span>
      metric_focus <span style="color:#f92672">&lt;-</span> yardstick<span style="color:#f92672">::</span><span style="color:#a6e22e">metric_set</span>(mape)
    } else {
      metric_eval <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;rmse&#34;</span> <span style="color:#75715e"># default</span>
      metric_focus <span style="color:#f92672">&lt;-</span> yardstick<span style="color:#f92672">::</span><span style="color:#a6e22e">metric_set</span>(rmse)
    }

    <span style="color:#75715e"># Hyperparameter tuning and store parameters</span>
    <span style="color:#a6e22e">set.seed</span>(seedval) <span style="color:#75715e"># set the seed</span>
    df_parameter <span style="color:#f92672">&lt;-</span>
      <span style="color:#a6e22e">tune_grid</span>(
                formula   <span style="color:#f92672">=</span> target <span style="color:#f92672">~</span> .,
                model     <span style="color:#f92672">=</span> mod,
                resamples <span style="color:#f92672">=</span> l_cv,
                grid      <span style="color:#f92672">=</span> <span style="color:#a6e22e">grid_random</span>(<span style="color:#a6e22e">parameters</span>(<span style="color:#a6e22e">cost_complexity</span>(),
                                                   <span style="color:#a6e22e">tree_depth</span>(),
                                                   <span style="color:#a6e22e">min_n</span>()),
                                        size <span style="color:#f92672">=</span> grid_size),
                metrics   <span style="color:#f92672">=</span> metric_focus,
                control   <span style="color:#f92672">=</span> <span style="color:#a6e22e">control_grid</span>(verbose <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
          ) <span style="color:#f92672">%&gt;%</span>
      <span style="color:#a6e22e">select_best</span>(metric_eval)

    <span style="color:#75715e"># CV Optimised Model</span>
    mod_final <span style="color:#f92672">&lt;-</span>
      <span style="color:#a6e22e">list</span>(parameters <span style="color:#f92672">=</span> df_parameter,
           df <span style="color:#f92672">=</span> <span style="color:#a6e22e">map2_df</span>(.x <span style="color:#f92672">=</span> l_cv<span style="color:#f92672">$</span>splits,
                        .y <span style="color:#f92672">=</span> l_cv<span style="color:#f92672">$</span>id,
                        <span style="color:#a6e22e">function </span>(split <span style="color:#f92672">=</span> .x, fold <span style="color:#f92672">=</span> .y)
                         {
                           <span style="color:#75715e"># Split the data into analysis</span>
                           <span style="color:#75715e"># and assessment tables</span>
                           df_analysis <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">analysis</span>(split)
                           df_assessment <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">assessment</span>(split)

                           <span style="color:#75715e"># Build the model</span>
                           mod_2 <span style="color:#f92672">&lt;-</span>
                            <span style="color:#a6e22e">decision_tree</span>(
                              mode <span style="color:#f92672">=</span> model_mode,
                              cost_complexity <span style="color:#f92672">=</span>
                                <span style="color:#a6e22e">as.numeric</span>(df_parameter[<span style="color:#e6db74">&#34;cost_complexity&#34;</span>]),
                              tree_depth <span style="color:#f92672">=</span>
                                <span style="color:#a6e22e">as.numeric</span>(df_parameter[<span style="color:#e6db74">&#34;tree_depth&#34;</span>]),
                              min_n <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(df_parameter[<span style="color:#e6db74">&#34;min_n&#34;</span>])
                                         ) <span style="color:#f92672">%&gt;%</span>
                             <span style="color:#a6e22e">set_engine</span>(<span style="color:#e6db74">&#34;rpart&#34;</span>) <span style="color:#f92672">%&gt;%</span>
                             <span style="color:#a6e22e">fit</span>(target <span style="color:#f92672">~</span> ., data <span style="color:#f92672">=</span> df_analysis)

                           <span style="color:#75715e"># Summarise Predictions</span>
                           table <span style="color:#f92672">&lt;-</span>
                             <span style="color:#a6e22e">tibble</span>(fold <span style="color:#f92672">=</span> fold,
                                    truth <span style="color:#f92672">=</span> df_assessment<span style="color:#f92672">$</span>target,
                                    .pred <span style="color:#f92672">=</span>
                                      <span style="color:#a6e22e">predict</span>(mod_2,
                                              new_data <span style="color:#f92672">=</span> df_assessment) <span style="color:#f92672">%&gt;%</span>
                                        <span style="color:#a6e22e">unlist</span>()
                                    )
                            })
              )

    <span style="color:#75715e"># Predict using the model and naive approach</span>
    df_output <span style="color:#f92672">&lt;-</span> <span style="color:#75715e"># upper bound alignment</span>
        <span style="color:#a6e22e">data.frame</span>(truth <span style="color:#f92672">=</span> target, <span style="color:#75715e"># actual house price</span>
                   .naive <span style="color:#f92672">=</span> <span style="color:#a6e22e">median</span>(target)
                   )


    <span style="color:#75715e"># Calculate the upper bound and predictive score</span>
    <span style="color:#a6e22e">if</span>(evaluation_metric <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;rmse&#34;</span>) {

      <span style="color:#75715e"># Calculate rmse for naive model</span>
      UB <span style="color:#f92672">&lt;-</span>
        df_output <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">rmse</span>(truth, .naive) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()

      <span style="color:#75715e"># Calculate rmse for tuned decision tree</span>
      pred <span style="color:#f92672">&lt;-</span>
        mod_final[[<span style="color:#e6db74">&#34;df&#34;</span>]] <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">rmse</span>(truth, .pred) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()

    } else <span style="color:#a6e22e">if </span>(evaluation_metric <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mae&#34;</span>) {

      <span style="color:#75715e"># Calculate mae for naive model</span>
      UB <span style="color:#f92672">&lt;-</span>
        df_output <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">mae</span>(truth, .naive) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()

      <span style="color:#75715e"># Calculate mae for tuned decision tree</span>
      pred <span style="color:#f92672">&lt;-</span>
        mod_final[[<span style="color:#e6db74">&#34;df&#34;</span>]] <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">mae</span>(truth, .pred) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()     

    } else <span style="color:#a6e22e">if </span>(evaluation_metric <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mape&#34;</span>) {

      <span style="color:#75715e"># Calculate mape for naive model</span>
      UB <span style="color:#f92672">&lt;-</span>
        df_output <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">mape</span>(truth, .naive) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()

      <span style="color:#75715e"># Calculate mape for tuned decision tree</span>
      pred <span style="color:#f92672">&lt;-</span>
        mod_final[[<span style="color:#e6db74">&#34;df&#34;</span>]] <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">mape</span>(truth, .pred) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()

    } else {

      <span style="color:#75715e"># Calculate rmse for naive model</span>
      UB <span style="color:#f92672">&lt;-</span>
        df_output <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">rmse</span>(truth, .naive) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()

      <span style="color:#75715e"># Calculate rmse for tuned decision tree</span>
      pred <span style="color:#f92672">&lt;-</span>
        mod_final[[<span style="color:#e6db74">&#34;df&#34;</span>]] <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">rmse</span>(truth, .pred) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">select</span>(.estimate) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">as.numeric</span>()  
    }

    <span style="color:#75715e"># Calculate PPS score</span>
    PPS <span style="color:#f92672">&lt;-</span> (pred <span style="color:#f92672">-</span> UB) <span style="color:#f92672">/</span> (LB <span style="color:#f92672">-</span> UB)

    <span style="color:#75715e"># Return PPS score</span>
    <span style="color:#a6e22e">return</span>(PPS)

    }
</code></pre></div><p>Now that we have a PPS function set-up, the output can be tested on a
couple of variables. A quick visual correlation analysis is run on the
numerical variables to choose some variables which exhibit strong and
weak linear relationships.</p>
<figure>
    <img src="https://registea.github.io/project_portfolio/images/project2/corr_plot-1.png"/> 
</figure>

<p>The following two variables are chosen:</p>
<ul>
<li>overallqual: Numerical variable which plot indicates strong positive
correlation</li>
<li>miscval: Numerical variable which the plot indicates near zero
variance</li>
</ul>
<p>The table below shows that none of the variables in their own right have
a particularly high PPS score. However, the variable identified as
being important (overallqual) seem to have a relatively high score,
while miscval is virtually 0.</p>
<table>
<thead>
<tr>
<th align="center">Variable</th>
<th align="center">PPS</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">overallqual</td>
<td align="center">41.7%</td>
</tr>
<tr>
<td align="center">bsmtfinsf2</td>
<td align="center">0.2%</td>
</tr>
</tbody>
</table>
<h1 id="understanding-feature-importance">Understanding Feature Importance</h1>
<p>Now that we have a PPS function, each predictor will be scored using
it’s methodology. The code below applies each predictor to the PPS
function. The output below shows that the implementation of the PPS
function took over 15 minutes, this is relatively resource heavy
compared to other filter methods e.g. correlation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">system.time</span>({

  <span style="color:#75715e"># Isolate saleprice in training data  </span>
  df_target <span style="color:#f92672">&lt;-</span>
    df_model <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">filter</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(saleprice)) <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">mutate</span>(saleprice <span style="color:#f92672">=</span> <span style="color:#a6e22e">log</span>(saleprice)) <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">select</span>(saleprice)

  <span style="color:#75715e"># Calculate PPS</span>
  df_pps_full <span style="color:#f92672">&lt;-</span>
  <span style="color:#a6e22e">sapply</span>(df_model <span style="color:#f92672">%&gt;%</span>
           <span style="color:#a6e22e">filter</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(saleprice)) <span style="color:#f92672">%&gt;%</span>
           <span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>saleprice)
           ,
         <span style="color:#a6e22e">function</span>(var)
           <span style="color:#a6e22e">f_PPS</span>(predictor <span style="color:#f92672">=</span> var, <span style="color:#75715e"># predictor variable</span>
                 target <span style="color:#f92672">=</span> df_target<span style="color:#f92672">$</span>saleprice, <span style="color:#75715e"># target variable</span>
                 model_mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;regression&#34;</span>, <span style="color:#75715e"># regression or classification</span>
                 evaluation_metric <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rmse&#34;</span>, <span style="color:#75715e"># prediction evaluation metrics</span>
                 LB <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e"># Lower Bound e.g. RMSE perfect score is 0</span>
                 grid_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, <span style="color:#75715e"># Size of tuning grid</span>
                 folds <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span> <span style="color:#75715e"># Folds in cross validation</span>
                 )
         ) <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">as.data.frame</span>() <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">rownames_to_column</span>() <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">rename</span>(Variable <span style="color:#f92672">=</span> rowname,
           PPS <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;.&#34;</span>)

  <span style="color:#75715e"># Remove PPS</span>
  <span style="color:#a6e22e">rm</span>(df_target)
})
</code></pre></div><pre><code>##    user  system elapsed
##  812.93    1.43  868.72
</code></pre>
<p>The plot below shows the distribution of PPS against the predictors in
the dataset. The most common PPS scores is around 0%, indicating that 16
variables have no predictive power, using this methodology. On a
relative scale between 0 and the best PPS of 0.42, there are 19
predictors with relatively strong predictive power.</p>
<figure>
    <img src="https://registea.github.io/project_portfolio/images/project2/dist_pps-1.png"/> 
</figure>

<p>Using PPS we are able to isolate the explanatory variables with the most
predictive power, these can be seen in the table below.</p>
<table>
<thead>
<tr>
<th align="center">Variable</th>
<th align="center">PPS</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">overallqual</td>
<td align="center">41.7%</td>
</tr>
<tr>
<td align="center">grlivarea</td>
<td align="center">30.3%</td>
</tr>
<tr>
<td align="center">neighborhood</td>
<td align="center">29.5%</td>
</tr>
<tr>
<td align="center">garagecars</td>
<td align="center">27.7%</td>
</tr>
<tr>
<td align="center">exterqual</td>
<td align="center">25.7%</td>
</tr>
<tr>
<td align="center">bsmtqual</td>
<td align="center">25.2%</td>
</tr>
<tr>
<td align="center">garagearea</td>
<td align="center">25.1%</td>
</tr>
</tbody>
</table>
<h1 id="conclusion">Conclusion</h1>
<p>After reviewing the PPS mechanism, my thoughts are:</p>
<ul>
<li>The PPS is a conceptually simple idea, but effective at relaying a
non-symmetrical relationship between pairs of variables</li>
<li>I found it useful that it provides a unified score against both
numeric and categorical predictors</li>
<li>PPS sits on a scale of 0 - 1, but it is not immediately clear what a
good or bad score is. In our example, the best score was 42%</li>
<li>While my implementation of the PPS could be hugely optimised, it is
still a lot slower than comparative filter functions and this is a
consideration when working with larger datasets</li>
<li>Some advanced model methodologies, such as Random Forest are slow to
build. Reducing the input dataset, using an approach like PPS could
significantly improve the speed of the overall model building
process</li>
</ul>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://registea.github.io/project_portfolio" >
    &copy;  Anthony Registe 2020 
  </a>
    <div>







<a href="https://www.linkedin.com/in/anthony-registe/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/registea/" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>







</div>
  </div>
</footer>

    

  <script src="https://registea.github.io/project_portfolio/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
